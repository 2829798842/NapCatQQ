const _0x32fb47=_0x4948;(function(_0x36dc88,_0x3bd2fb){const _0x17b0a3=_0x4948,_0x59e102=_0x36dc88();while(!![]){try{const _0x23df33=-parseInt(_0x17b0a3(0x1e3))/0x1*(-parseInt(_0x17b0a3(0x1e5))/0x2)+parseInt(_0x17b0a3(0x1ee))/0x3+parseInt(_0x17b0a3(0x1d9))/0x4+parseInt(_0x17b0a3(0x1f4))/0x5+parseInt(_0x17b0a3(0x1f9))/0x6*(parseInt(_0x17b0a3(0x1c6))/0x7)+-parseInt(_0x17b0a3(0x21a))/0x8*(parseInt(_0x17b0a3(0x205))/0x9)+-parseInt(_0x17b0a3(0x1d5))/0xa;if(_0x23df33===_0x3bd2fb)break;else _0x59e102['push'](_0x59e102['shift']());}catch(_0x2dfc31){_0x59e102['push'](_0x59e102['shift']());}}}(_0x3eda,0x3d04f));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x14f405}from'node:fs';import _0x45a305 from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';function _0x3eda(){const _0x2d8b93=['iRjDT','sep','guAWC','REPLY','ptt','56KGAiXA','opoVd','gif','string','mp4','IgWer','uploadFile','reply','then','PIC','kBRIu','tpmJI','jpg','EUBIP','text','10977900ldXJQf','ZXToj','end','writeFile','564008KQpKLF','get','获取视频信息失败','_0.png','getImageSize','pic','Bot\x20Test','QSid','MARKDOWN','hhQpO','2LlbyLq','copyFile','276930BvKiuD','stat','height','catch','stringify','emoji','screenshots','Ori','sysface','864483NTOSfH','语音转换失败,\x20请检查语音文件是否正常','size','rps','file','OMvmR','1736870YKxhEk','face','BoheI','time','FILE','352398rTOrSv','lweap','RPS','error','notAt','GmTDW','miniapp','replace','AniStickerType','FACE','KIOEA','[商城表情]','9zEDMuo','markdown','gpCBq','LuKfp','unlink','PTT','SIhwa','qegxh','zzkWF','Thumb','ARK','qpqJn','https://www.bilibili.com/','width','toString','dHfFr','pQMYt','TEXT','UeCyA','VIDEO','dirname','1404848JXLlLh','olsPJ','aMgAi','ljTjW','文件异常，大小为0','QDes','mface','uoZHk'];_0x3eda=function(){return _0x2d8b93;};return _0x3eda();}import{encodeSilk}from'@/common/utils/audio';import _0x2b99c8 from'./face_config.json';import*as _0x5c499b from'node:path';import{SignMiniApp}from'../apis';export const mFaceCache=new Map();function _0x4948(_0x2b82bb,_0x3c2028){const _0x3edaab=_0x3eda();return _0x4948=function(_0x494822,_0x3be8f7){_0x494822=_0x494822-0x1bc;let _0x4cc27f=_0x3edaab[_0x494822];return _0x4cc27f;},_0x4948(_0x2b82bb,_0x3c2028);}export class SendMsgElementConstructor{static[_0x32fb47(0x1d4)](_0x27979f){const _0x1f213e=_0x32fb47;return{'elementType':ElementType[_0x1f213e(0x216)],'elementId':'','textElement':{'content':_0x27979f,'atType':AtType[_0x1f213e(0x1fd)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x511c01,_0x179479,_0x1b5357,_0xc302c6){const _0x3de03c=_0x32fb47;return{'elementType':ElementType[_0x3de03c(0x216)],'elementId':'','textElement':{'content':'@'+_0xc302c6,'atType':_0x1b5357,'atUid':_0x511c01,'atTinyId':'','atNtUid':_0x179479}};}static[_0x32fb47(0x1cd)](_0x26ae1c,_0x1ab98c,_0x255a05,_0x52359e){const _0x4c5239=_0x32fb47;return{'elementType':ElementType[_0x4c5239(0x1c4)],'elementId':'','replyElement':{'replayMsgSeq':_0x26ae1c,'replayMsgId':_0x1ab98c,'senderUin':_0x255a05,'senderUinStr':_0x52359e}};}static async[_0x32fb47(0x1de)](_0x39dcc3,_0x1021fe='',_0x599057=0x0){const _0x479a8e=_0x32fb47,_0x2bc86c={'aMgAi':'文件异常，大小为0','LuKfp':function(_0x512cfe,_0x33c24d){return _0x512cfe(_0x33c24d);}},{md5:_0x5a4b92,fileName:_0x388a6a,path:_0x2223c8,fileSize:_0x26c724}=await NTQQFileApi[_0x479a8e(0x1cc)](_0x39dcc3,ElementType[_0x479a8e(0x1cf)],_0x599057);if(_0x26c724===0x0)throw _0x2bc86c[_0x479a8e(0x21c)];const _0x168673=await NTQQFileApi[_0x479a8e(0x1dd)](_0x39dcc3),_0x4f2f2d={'md5HexStr':_0x5a4b92,'fileSize':_0x26c724['toString'](),'picWidth':_0x168673?.['width'],'picHeight':_0x168673?.[_0x479a8e(0x1e7)],'fileName':_0x388a6a,'sourcePath':_0x2223c8,'original':!![],'picType':_0x2bc86c[_0x479a8e(0x208)](isGIF,_0x39dcc3)?PicType[_0x479a8e(0x1c8)]:PicType[_0x479a8e(0x1d2)],'picSubType':_0x599057,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x1021fe};return{'elementType':ElementType[_0x479a8e(0x1cf)],'elementId':'','picElement':_0x4f2f2d};}static async[_0x32fb47(0x1f2)](_0x52b6f4,_0x26d42f='',_0x4ed5bc=''){const _0x4280e1=_0x32fb47,_0x365718={'cyckv':function(_0x24b823,_0x49ebc2){return _0x24b823===_0x49ebc2;},'dHfFr':_0x4280e1(0x1bd),'GmTDW':function(_0x11cb11,_0x167a39){return _0x11cb11||_0x167a39;}},{md5:_0x4c417b,fileName:_0x4b1497,path:_0x52f2a0,fileSize:_0x5815cb}=await NTQQFileApi[_0x4280e1(0x1cc)](_0x52b6f4,ElementType[_0x4280e1(0x1f8)]);if(_0x365718['cyckv'](_0x5815cb,0x0))throw _0x365718[_0x4280e1(0x214)];const _0x4d0036={'elementType':ElementType[_0x4280e1(0x1f8)],'elementId':'','fileElement':{'fileName':_0x365718[_0x4280e1(0x1fe)](_0x26d42f,_0x4b1497),'folderId':_0x4ed5bc,'filePath':_0x52f2a0,'fileSize':_0x5815cb[_0x4280e1(0x213)]()}};return _0x4d0036;}static async['video'](_0x5ddc0b,_0x3aab81='',_0x4661bf=''){const _0x225d60=_0x32fb47,_0x4f4437={'EUBIP':function(_0x56d1af,_0x5012ca){return _0x56d1af(_0x5012ca);},'qpqJn':function(_0x3814b6,_0x1a2437){return _0x3814b6(_0x1a2437);},'pQMYt':_0x225d60(0x1d7),'uoZHk':_0x225d60(0x1fc),'ZXToj':function(_0x20d30c,_0x25e14b){return _0x20d30c+_0x25e14b;},'SIhwa':function(_0x3fc9f9,_0x38eef8){return _0x3fc9f9===_0x38eef8;},'ljTjW':'文件异常，大小为0','zzkWF':_0x225d60(0x1ca),'eNliO':function(_0x427660,_0x3e1a2a,_0x43cf87){return _0x427660(_0x3e1a2a,_0x43cf87);},'BINUh':_0x225d60(0x1db),'tpmJI':function(_0x9c0621,_0x2af9da){return _0x9c0621||_0x2af9da;}},{fileName:_0x9e4f69,path:_0x29ecce,fileSize:_0x12c1ae,md5:_0x5aca15}=await NTQQFileApi[_0x225d60(0x1cc)](_0x5ddc0b,ElementType[_0x225d60(0x218)]);if(_0x4f4437[_0x225d60(0x20b)](_0x12c1ae,0x0))throw _0x4f4437[_0x225d60(0x1bc)];let _0x56a30b=_0x29ecce[_0x225d60(0x200)](_0x5c499b['sep']+_0x225d60(0x1ec)+_0x5c499b['sep'],_0x5c499b[_0x225d60(0x1c2)]+_0x225d60(0x20e)+_0x5c499b[_0x225d60(0x1c2)]);_0x56a30b=_0x5c499b[_0x225d60(0x219)](_0x56a30b);let _0x5cfb44={'width':0x780,'height':0x438,'time':0xf,'format':_0x4f4437[_0x225d60(0x20d)],'size':_0x12c1ae,'filePath':_0x5ddc0b};try{_0x5cfb44=await getVideoInfo(_0x29ecce);}catch(_0x39e4aa){_0x4f4437['eNliO'](logError,_0x4f4437['BINUh'],_0x39e4aa);}const _0x45e017=new Promise((_0x458f4d,_0x4a3395)=>{const _0x640e76=_0x225d60,_0x5cad9b={'hhQpO':function(_0x4628b4,_0x523f3c){const _0x50fb27=_0x4948;return _0x4f4437[_0x50fb27(0x1d3)](_0x4628b4,_0x523f3c);},'kBRIu':function(_0x5d39ff,_0x49b38d){return _0x5d39ff(_0x49b38d);},'iRjDT':'获取视频封面失败，使用默认封面'},_0x2dc45b=_0x5aca15+_0x640e76(0x1dc),_0x12360b=_0x5c499b['join'](_0x56a30b,_0x2dc45b);_0x4f4437[_0x640e76(0x210)](_0x45a305,_0x5ddc0b)['on'](_0x4f4437[_0x640e76(0x215)],()=>{})['on'](_0x4f4437[_0x640e76(0x1c0)],_0x4cfc72=>{const _0x309084=_0x640e76,_0x46848d={'lweap':function(_0x4308ce,_0x1a61b6){const _0x5b0ed5=_0x4948;return _0x5cad9b[_0x5b0ed5(0x1d0)](_0x4308ce,_0x1a61b6);}};logDebug(_0x5cad9b[_0x309084(0x1c1)],_0x4cfc72),_0x4661bf?_0x14f405[_0x309084(0x1e4)](_0x4661bf,_0x12360b)[_0x309084(0x1ce)](()=>{const _0x15d55d=_0x309084;_0x46848d[_0x15d55d(0x1fa)](_0x458f4d,_0x12360b);})[_0x309084(0x1e8)](_0x4a3395):_0x14f405[_0x309084(0x1d8)](_0x12360b,defaultVideoThumb)['then'](()=>{const _0x1d0f9f=_0x309084;_0x5cad9b[_0x1d0f9f(0x1e2)](_0x458f4d,_0x12360b);})[_0x309084(0x1e8)](_0x4a3395);})[_0x640e76(0x1eb)]({'timestamps':[0x0],'filename':_0x2dc45b,'folder':_0x56a30b,'size':_0x4f4437['ZXToj'](_0x4f4437[_0x640e76(0x1d6)](_0x5cfb44[_0x640e76(0x212)],'x'),_0x5cfb44['height'])})['on'](_0x4f4437[_0x640e76(0x215)],()=>{const _0x4f5d41=_0x640e76;_0x4f4437[_0x4f5d41(0x1d3)](_0x458f4d,_0x12360b);});}),_0x474527=new Map(),_0x1feaf7=await _0x45e017,_0x2c5ced=(await _0x14f405[_0x225d60(0x1e6)](_0x1feaf7))[_0x225d60(0x1f0)];_0x474527['set'](0x0,_0x1feaf7);const _0x413110=await _0x4f4437[_0x225d60(0x210)](calculateFileMD5,_0x1feaf7),_0x31df31={'elementType':ElementType[_0x225d60(0x218)],'elementId':'','videoElement':{'fileName':_0x4f4437[_0x225d60(0x1d1)](_0x3aab81,_0x9e4f69),'filePath':_0x29ecce,'videoMd5':_0x5aca15,'thumbMd5':_0x413110,'fileTime':_0x5cfb44[_0x225d60(0x1f7)],'thumbPath':_0x474527,'thumbSize':_0x2c5ced,'thumbWidth':_0x5cfb44[_0x225d60(0x212)],'thumbHeight':_0x5cfb44[_0x225d60(0x1e7)],'fileSize':_0x4f4437[_0x225d60(0x1d6)]('',_0x12c1ae)}};return _0x31df31;}static async[_0x32fb47(0x1c5)](_0x3dffa3){const _0x20807e=_0x32fb47,_0x476f6c={'IgWer':function(_0x30827f,_0x365760){return _0x30827f(_0x365760);},'guAWC':_0x20807e(0x1ef),'OMvmR':'文件异常，大小为0','DckjO':function(_0x46d5fe,_0x165403){return _0x46d5fe||_0x165403;}},{converted:_0x35daf6,path:_0x578bda,duration:_0xd43c79}=await _0x476f6c[_0x20807e(0x1cb)](encodeSilk,_0x3dffa3);if(!_0x578bda)throw _0x476f6c[_0x20807e(0x1c3)];const {md5:_0x25fc8f,fileName:_0x36eef7,path:_0x26b0c3,fileSize:_0x3bcd87}=await NTQQFileApi[_0x20807e(0x1cc)](_0x578bda,ElementType[_0x20807e(0x20a)]);if(_0x3bcd87===0x0)throw _0x476f6c[_0x20807e(0x1f3)];return _0x35daf6&&_0x14f405[_0x20807e(0x209)](_0x578bda)[_0x20807e(0x1ce)](),{'elementType':ElementType[_0x20807e(0x20a)],'elementId':'','pttElement':{'fileName':_0x36eef7,'filePath':_0x26b0c3,'md5HexStr':_0x25fc8f,'fileSize':_0x3bcd87,'duration':_0x476f6c['DckjO'](_0xd43c79,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x32fb47(0x1f5)](_0x202582){const _0x3f407b=_0x32fb47,_0x5db3ea={'gpCBq':function(_0x6c7e6,_0x3823a7){return _0x6c7e6(_0x3823a7);}},_0x4a2553=_0x2b99c8[_0x3f407b(0x1ed)],_0x4dde37=_0x2b99c8[_0x3f407b(0x1ea)],_0x4372fb=_0x4a2553['find'](_0x5ce9fa=>_0x5ce9fa[_0x3f407b(0x1e0)]===_0x202582[_0x3f407b(0x213)]());_0x202582=_0x5db3ea[_0x3f407b(0x207)](parseInt,_0x202582[_0x3f407b(0x213)]());let _0x34185e=0x1;return _0x202582>=0xde&&(_0x34185e=0x2),_0x4372fb['AniStickerType']&&(_0x34185e=0x3),{'elementType':ElementType[_0x3f407b(0x202)],'elementId':'','faceElement':{'faceIndex':_0x202582,'faceType':_0x34185e,'faceText':_0x4372fb[_0x3f407b(0x1be)],'stickerId':_0x4372fb['AniStickerId'],'stickerType':_0x4372fb[_0x3f407b(0x201)],'packId':_0x4372fb['AniStickerPackId'],'sourceType':0x1}};}static[_0x32fb47(0x1bf)](_0xde80ef,_0x3f817e,_0x3c1164,_0x5e9d36){const _0x3766fe=_0x32fb47,_0x522930={'qegxh':_0x3766fe(0x204)};return{'elementType':ElementType['MFACE'],'marketFaceElement':{'emojiPackageId':_0xde80ef,'emojiId':_0x3f817e,'key':_0x3c1164,'faceName':_0x5e9d36||mFaceCache[_0x3766fe(0x1da)](_0x3f817e)||_0x522930[_0x3766fe(0x20c)]}};}static['dice'](_0x32cd38){const _0x102ab7=_0x32fb47,_0xcf9f5b={'OjmhV':'[骰子]'};return{'elementType':ElementType[_0x102ab7(0x202)],'elementId':'','faceElement':{'faceIndex':FaceIndex['dice'],'faceType':FaceType['dice'],'faceText':_0xcf9f5b['OjmhV'],'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x32fb47(0x1f1)](_0x58cb56){const _0xd1f665=_0x32fb47;return{'elementType':ElementType[_0xd1f665(0x202)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0xd1f665(0x1fb)],'faceText':'[包剪锤]','faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['ark'](_0x3aa433){const _0x1036d9=_0x32fb47,_0xb8785f={'UeCyA':function(_0x4d7be4,_0x5b4158){return _0x4d7be4!==_0x5b4158;},'opoVd':_0x1036d9(0x1c9)};return _0xb8785f[_0x1036d9(0x217)](typeof _0x3aa433,_0xb8785f[_0x1036d9(0x1c7)])&&(_0x3aa433=JSON[_0x1036d9(0x1e9)](_0x3aa433)),{'elementType':ElementType[_0x1036d9(0x20f)],'elementId':'','arkElement':{'bytesData':_0x3aa433,'linkInfo':null,'subElementType':null}};}static[_0x32fb47(0x206)](_0x37fcf4){const _0x466522=_0x32fb47;return{'elementType':ElementType[_0x466522(0x1e1)],'elementId':'','markdownElement':{'content':_0x37fcf4}};}static async[_0x32fb47(0x1ff)](){const _0x48cc35=_0x32fb47,_0xc2c515={'KIOEA':_0x48cc35(0x1df),'BoheI':'https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','olsPJ':'https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png'};let _0x24ad8a=await SignMiniApp({'prompt':_0xc2c515[_0x48cc35(0x203)],'title':_0xc2c515[_0x48cc35(0x203)],'preview':_0xc2c515[_0x48cc35(0x1f6)],'jumpUrl':_0x48cc35(0x211),'tag':_0xc2c515[_0x48cc35(0x203)],'tagIcon':_0xc2c515['olsPJ'],'source':_0xc2c515[_0x48cc35(0x203)],'sourcelogo':_0xc2c515[_0x48cc35(0x21b)]});return{'elementType':ElementType[_0x48cc35(0x20f)],'elementId':'','arkElement':{'bytesData':_0x24ad8a,'linkInfo':null,'subElementType':null}};}}