const _0x14275c=_0x4542;(function(_0xd62b04,_0x5eaaba){const _0x246641=_0x4542,_0x59b75c=_0xd62b04();while(!![]){try{const _0x292f0e=parseInt(_0x246641(0xcc))/0x1*(-parseInt(_0x246641(0x8b))/0x2)+parseInt(_0x246641(0x92))/0x3*(parseInt(_0x246641(0xb8))/0x4)+-parseInt(_0x246641(0xb4))/0x5+-parseInt(_0x246641(0xcd))/0x6*(parseInt(_0x246641(0x8d))/0x7)+-parseInt(_0x246641(0xae))/0x8*(parseInt(_0x246641(0x9c))/0x9)+parseInt(_0x246641(0x85))/0xa*(parseInt(_0x246641(0xbf))/0xb)+parseInt(_0x246641(0x71))/0xc*(parseInt(_0x246641(0xb9))/0xd);if(_0x292f0e===_0x5eaaba)break;else _0x59b75c['push'](_0x59b75c['shift']());}catch(_0x4094e3){_0x59b75c['push'](_0x59b75c['shift']());}}}(_0x11a4,0x72483));function _0x4542(_0x1bbb22,_0x4fb51a){const _0x11a4a7=_0x11a4();return _0x4542=function(_0x45429a,_0x4f7cb5){_0x45429a=_0x45429a-0x70;let _0x4bf9d1=_0x11a4a7[_0x45429a];return _0x4bf9d1;},_0x4542(_0x1bbb22,_0x4fb51a);}import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x2dffbd}from'node:fs';import _0x4ca51e from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x413688 from'./face_config.json';import*as _0x299c69 from'node:path';function _0x11a4(){const _0x2339ee=['dice','string','size','JSlzQ','uploadFile','2OrExEZ','5452368fRrZBu','width','aFInW','12pQnqcV','end','replace','NTWKZ','XVWIU','mTmPX','ptt','rps','rLDcT','KzqTh','[商城表情]','XniUl','[包剪锤]','ZxCYM','mFQKu','CAEIf','face','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','video','QSid','10sZZBrE','aFchA','sep','reply','LZDpb','screenshots','552786JfEwvZ','text','7Nnraol','FACE','ark','find','文件异常，大小为0','15phvvNd','NAIQM','_0.png','https://www.bilibili.com/','RPS','zOLbZ','获取视频封面失败，使用默认封面','VIDEO','RLdNW','AniStickerType','12591wQUdGr','Bot\x20Test','MFACE','HkKwh','QDes','then','XKsIn','[骰子]','join','QFZbW','toString','REPLY','pic','GpFTi','set','ubZiU','ARK','lLidE','912qyPGUs','XVKIU','owQic','catch','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','writeFile','3304175PNMrRH','emoji','AniStickerPackId','get','230164ipIfgJ','27725243omIWRi','TRBly','KtLUc','Ori','aAguQ','miniapp','3624698SrYWgw','height','yHeGJ','FILE','PTT','unlink','KShlV','SDhnh'];_0x11a4=function(){return _0x2339ee;};return _0x11a4();}import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x14275c(0x8c)](_0x46c722){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':_0x46c722,'atType':AtType['notAt'],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0x36bfa8,_0x3abb67,_0x11b6fa,_0x55d76c){return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':'@'+_0x55d76c,'atType':_0x11b6fa,'atUid':_0x36bfa8,'atTinyId':'','atNtUid':_0x3abb67}};}static[_0x14275c(0x88)](_0x2456d4,_0x38b0e2,_0x6f5579,_0x8bbed6){const _0xe19c3e=_0x14275c;return{'elementType':ElementType[_0xe19c3e(0xa7)],'elementId':'','replyElement':{'replayMsgSeq':_0x2456d4,'replayMsgId':_0x38b0e2,'senderUin':_0x6f5579,'senderUinStr':_0x8bbed6}};}static async[_0x14275c(0xa8)](_0x5a79e1,_0x3b30ab='',_0x5daade=0x0){const _0x201654=_0x14275c,_0x1be54e={'KzqTh':function(_0x5abd40,_0xcc73f6){return _0x5abd40===_0xcc73f6;},'XVKIU':_0x201654(0x91),'aAguQ':function(_0x7d0a66,_0x5bd0e4){return _0x7d0a66(_0x5bd0e4);}},{md5:_0x225e24,fileName:_0x11d2c2,path:_0x200d49,fileSize:_0x25f732}=await NTQQFileApi[_0x201654(0xcb)](_0x5a79e1,ElementType['PIC'],_0x5daade);if(_0x1be54e[_0x201654(0x7a)](_0x25f732,0x0))throw _0x1be54e[_0x201654(0xaf)];const _0x31d8c4=await NTQQFileApi['getImageSize'](_0x5a79e1),_0x4974fc={'md5HexStr':_0x225e24,'fileSize':_0x25f732[_0x201654(0xa6)](),'picWidth':_0x31d8c4?.[_0x201654(0xce)],'picHeight':_0x31d8c4?.['height'],'fileName':_0x11d2c2,'sourcePath':_0x200d49,'original':!![],'picType':_0x1be54e[_0x201654(0xbd)](isGIF,_0x5a79e1)?PicType['gif']:PicType['jpg'],'picSubType':_0x5daade,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x3b30ab};return{'elementType':ElementType['PIC'],'elementId':'','picElement':_0x4974fc};}static async['file'](_0x3212e0,_0x54dc41='',_0x9ee402=''){const _0x4cca1a=_0x14275c,_0x28c144={'BFvyG':function(_0xdcf635,_0x567645){return _0xdcf635===_0x567645;}},{md5:_0x2a0479,fileName:_0xd737c3,path:_0x5deea0,fileSize:_0x35b46a}=await NTQQFileApi[_0x4cca1a(0xcb)](_0x3212e0,ElementType[_0x4cca1a(0xc2)]);if(_0x28c144['BFvyG'](_0x35b46a,0x0))throw _0x4cca1a(0x91);const _0x4b50ba={'elementType':ElementType[_0x4cca1a(0xc2)],'elementId':'','fileElement':{'fileName':_0x54dc41||_0xd737c3,'folderId':_0x9ee402,'filePath':_0x5deea0,'fileSize':_0x35b46a['toString']()}};return _0x4b50ba;}static async[_0x14275c(0x83)](_0x8123eb,_0x583bc1='',_0xc1884=''){const _0x4a7903=_0x14275c,_0x45af1e={'TRBly':function(_0x38d7fd,_0x2378af){return _0x38d7fd(_0x2378af);},'yHeGJ':_0x4a7903(0x98),'aLpup':function(_0x4cc895,_0x517a6c){return _0x4cc895(_0x517a6c);},'JSlzQ':function(_0xfc6eb6,_0xf7d022){return _0xfc6eb6+_0xf7d022;},'HkKwh':_0x4a7903(0x72),'aFInW':function(_0x15082d,_0x4305ee){return _0x15082d===_0x4305ee;},'QFZbW':'mp4','gjPFz':function(_0x2e882e,_0x595a8a,_0x1e759a){return _0x2e882e(_0x595a8a,_0x1e759a);},'lLidE':'获取视频信息失败','NTWKZ':function(_0x585dda,_0x1144c8){return _0x585dda(_0x1144c8);},'zOLbZ':function(_0x130af6,_0x1842e9){return _0x130af6||_0x1842e9;}},{fileName:_0x2d0330,path:_0x19c1de,fileSize:_0x4796f5,md5:_0xfe5e6b}=await NTQQFileApi[_0x4a7903(0xcb)](_0x8123eb,ElementType[_0x4a7903(0x99)]);if(_0x45af1e[_0x4a7903(0x70)](_0x4796f5,0x0))throw _0x4a7903(0x91);let _0x2ea41d=_0x19c1de[_0x4a7903(0x73)](_0x299c69[_0x4a7903(0x87)]+_0x4a7903(0xbc)+_0x299c69[_0x4a7903(0x87)],_0x299c69[_0x4a7903(0x87)]+'Thumb'+_0x299c69[_0x4a7903(0x87)]);_0x2ea41d=_0x299c69['dirname'](_0x2ea41d);let _0x4d2b21={'width':0x780,'height':0x438,'time':0xf,'format':_0x45af1e[_0x4a7903(0xa5)],'size':_0x4796f5,'filePath':_0x8123eb};try{_0x4d2b21=await _0x45af1e[_0x4a7903(0xba)](getVideoInfo,_0x19c1de);}catch(_0x2c1fb5){_0x45af1e['gjPFz'](logError,_0x45af1e[_0x4a7903(0xad)],_0x2c1fb5);}const _0x28d671=new Promise((_0x20e29c,_0x10d431)=>{const _0x55932d=_0x4a7903,_0x36e15c={'rLDcT':function(_0x23737c,_0x28c3cb){const _0xc74319=_0x4542;return _0x45af1e[_0xc74319(0xba)](_0x23737c,_0x28c3cb);},'KtLUc':function(_0x1d6d4a,_0x481c30){const _0x3ab5f3=_0x4542;return _0x45af1e[_0x3ab5f3(0xba)](_0x1d6d4a,_0x481c30);},'XniUl':_0x45af1e[_0x55932d(0xc1)]},_0x5ef63a=_0xfe5e6b+_0x55932d(0x94),_0x4779ae=_0x299c69[_0x55932d(0xa4)](_0x2ea41d,_0x5ef63a);_0x45af1e['aLpup'](_0x4ca51e,_0x8123eb)['on'](_0x55932d(0x72),()=>{})['on']('error',_0x1ba3e0=>{const _0x459286=_0x55932d,_0x1fe340={'ubZiU':function(_0x567070,_0x780a3f){return _0x36e15c['rLDcT'](_0x567070,_0x780a3f);},'owQic':function(_0x5c2f39,_0x21cd32){const _0x344937=_0x4542;return _0x36e15c[_0x344937(0xbb)](_0x5c2f39,_0x21cd32);}};logDebug(_0x36e15c[_0x459286(0x7c)],_0x1ba3e0),_0xc1884?_0x2dffbd['copyFile'](_0xc1884,_0x4779ae)[_0x459286(0xa1)](()=>{const _0x539ecd=_0x459286;_0x1fe340[_0x539ecd(0xab)](_0x20e29c,_0x4779ae);})[_0x459286(0xb1)](_0x10d431):_0x2dffbd[_0x459286(0xb3)](_0x4779ae,defaultVideoThumb)['then'](()=>{const _0x30d41e=_0x459286;_0x1fe340[_0x30d41e(0xb0)](_0x20e29c,_0x4779ae);})[_0x459286(0xb1)](_0x10d431);})[_0x55932d(0x8a)]({'timestamps':[0x0],'filename':_0x5ef63a,'folder':_0x2ea41d,'size':_0x45af1e[_0x55932d(0xca)](_0x45af1e[_0x55932d(0xca)](_0x4d2b21[_0x55932d(0xce)],'x'),_0x4d2b21[_0x55932d(0xc0)])})['on'](_0x45af1e[_0x55932d(0x9f)],()=>{const _0x395326=_0x55932d;_0x36e15c[_0x395326(0x79)](_0x20e29c,_0x4779ae);});}),_0x3a97c3=new Map(),_0x369d0e=await _0x28d671,_0x461753=(await _0x2dffbd['stat'](_0x369d0e))[_0x4a7903(0xc9)];_0x3a97c3[_0x4a7903(0xaa)](0x0,_0x369d0e);const _0x3c1863=await _0x45af1e[_0x4a7903(0x74)](calculateFileMD5,_0x369d0e),_0x145687={'elementType':ElementType['VIDEO'],'elementId':'','videoElement':{'fileName':_0x45af1e[_0x4a7903(0x97)](_0x583bc1,_0x2d0330),'filePath':_0x19c1de,'videoMd5':_0xfe5e6b,'thumbMd5':_0x3c1863,'fileTime':_0x4d2b21['time'],'thumbPath':_0x3a97c3,'thumbSize':_0x461753,'thumbWidth':_0x4d2b21[_0x4a7903(0xce)],'thumbHeight':_0x4d2b21[_0x4a7903(0xc0)],'fileSize':_0x45af1e[_0x4a7903(0xca)]('',_0x4796f5)}};return _0x145687;}static async[_0x14275c(0x77)](_0x165b69){const _0x15cfa7=_0x14275c,_0x211271={'mTmPX':function(_0x1c978f,_0x31544f){return _0x1c978f(_0x31544f);},'NAIQM':'语音转换失败,\x20请检查语音文件是否正常','HbWqR':function(_0x4a32e6,_0x43a9a9){return _0x4a32e6===_0x43a9a9;},'ZxCYM':_0x15cfa7(0x91),'LZDpb':function(_0x3a6484,_0x112fa5){return _0x3a6484||_0x112fa5;}},{converted:_0x25c26f,path:_0xc85a13,duration:_0x162c4e}=await _0x211271[_0x15cfa7(0x76)](encodeSilk,_0x165b69);if(!_0xc85a13)throw _0x211271[_0x15cfa7(0x93)];const {md5:_0x2b57c7,fileName:_0x3b8223,path:_0x580fbd,fileSize:_0x210f4}=await NTQQFileApi['uploadFile'](_0xc85a13,ElementType[_0x15cfa7(0xc3)]);if(_0x211271['HbWqR'](_0x210f4,0x0))throw _0x211271[_0x15cfa7(0x7e)];return _0x25c26f&&_0x2dffbd[_0x15cfa7(0xc4)](_0xc85a13)[_0x15cfa7(0xa1)](),{'elementType':ElementType[_0x15cfa7(0xc3)],'elementId':'','pttElement':{'fileName':_0x3b8223,'filePath':_0x580fbd,'md5HexStr':_0x2b57c7,'fileSize':_0x210f4,'duration':_0x211271[_0x15cfa7(0x89)](_0x162c4e,0x1),'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x14275c(0x81)](_0x34e9df){const _0x209686=_0x14275c,_0x2935f0={'SDhnh':function(_0x5812d0,_0x42f02b){return _0x5812d0(_0x42f02b);}},_0x4b1a71=_0x413688['sysface'],_0x518abf=_0x413688[_0x209686(0xb5)],_0x158aa2=_0x4b1a71[_0x209686(0x90)](_0x2b7eeb=>_0x2b7eeb[_0x209686(0x84)]===_0x34e9df['toString']());_0x34e9df=_0x2935f0[_0x209686(0xc6)](parseInt,_0x34e9df[_0x209686(0xa6)]());let _0x57bb94=0x1;return _0x34e9df>=0xde&&(_0x57bb94=0x2),_0x158aa2[_0x209686(0x9b)]&&(_0x57bb94=0x3),{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':_0x34e9df,'faceType':_0x57bb94,'faceText':_0x158aa2[_0x209686(0xa0)],'stickerId':_0x158aa2['AniStickerId'],'stickerType':_0x158aa2[_0x209686(0x9b)],'packId':_0x158aa2[_0x209686(0xb6)],'sourceType':0x1}};}static['mface'](_0x564be9,_0xe07e9,_0x1b62f5,_0x1a8c1f){const _0x253ffa=_0x14275c,_0x16c8d5={'aFchA':_0x253ffa(0x7b)};return{'elementType':ElementType[_0x253ffa(0x9e)],'marketFaceElement':{'emojiPackageId':_0x564be9,'emojiId':_0xe07e9,'key':_0x1b62f5,'faceName':_0x1a8c1f||mFaceCache[_0x253ffa(0xb7)](_0xe07e9)||_0x16c8d5[_0x253ffa(0x86)]}};}static[_0x14275c(0xc7)](_0x3e1708){const _0x3cb16f=_0x14275c;return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x3cb16f(0xc7)],'faceType':FaceType[_0x3cb16f(0xc7)],'faceText':_0x3cb16f(0xa3),'packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x14275c(0x78)](_0x5ad011){const _0x565f0a=_0x14275c,_0x4a599d={'mFQKu':_0x565f0a(0x7d)};return{'elementType':ElementType[_0x565f0a(0x8e)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x565f0a(0x96)],'faceText':_0x4a599d[_0x565f0a(0x7f)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x14275c(0x8f)](_0xd6eb3){const _0x1362ac=_0x14275c,_0x51a2ac={'ukwUv':function(_0x533306,_0x25a8d4){return _0x533306!==_0x25a8d4;},'XKsIn':_0x1362ac(0xc8)};return _0x51a2ac['ukwUv'](typeof _0xd6eb3,_0x51a2ac[_0x1362ac(0xa2)])&&(_0xd6eb3=JSON['stringify'](_0xd6eb3)),{'elementType':ElementType['ARK'],'elementId':'','arkElement':{'bytesData':_0xd6eb3,'linkInfo':null,'subElementType':null}};}static['markdown'](_0x4941db){return{'elementType':ElementType['MARKDOWN'],'elementId':'','markdownElement':{'content':_0x4941db}};}static async[_0x14275c(0xbe)](){const _0x4d4d50=_0x14275c,_0x1c1d02={'CAEIf':function(_0x4d1af4,_0x3ac40a){return _0x4d1af4(_0x3ac40a);},'XVWIU':_0x4d4d50(0x9d),'RLdNW':_0x4d4d50(0xb2),'GpFTi':_0x4d4d50(0x95),'KShlV':_0x4d4d50(0x82)};let _0xd6bc2d=await _0x1c1d02[_0x4d4d50(0x80)](SignMiniApp,{'prompt':_0x1c1d02[_0x4d4d50(0x75)],'title':_0x1c1d02['XVWIU'],'preview':_0x1c1d02[_0x4d4d50(0x9a)],'jumpUrl':_0x1c1d02[_0x4d4d50(0xa9)],'tag':_0x1c1d02[_0x4d4d50(0x75)],'tagIcon':_0x1c1d02[_0x4d4d50(0xc5)],'source':_0x1c1d02[_0x4d4d50(0x75)],'sourcelogo':_0x1c1d02[_0x4d4d50(0xc5)]});return{'elementType':ElementType[_0x4d4d50(0xac)],'elementId':'','arkElement':{'bytesData':_0xd6bc2d,'linkInfo':null,'subElementType':null}};}}