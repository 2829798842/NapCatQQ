const _0x95006f=_0x10d4;(function(_0xac883d,_0x14b4d4){const _0x42dfb8=_0x10d4,_0x52578a=_0xac883d();while(!![]){try{const _0xbb86a0=-parseInt(_0x42dfb8(0x213))/0x1+-parseInt(_0x42dfb8(0x214))/0x2+parseInt(_0x42dfb8(0x1f7))/0x3+-parseInt(_0x42dfb8(0x225))/0x4*(parseInt(_0x42dfb8(0x210))/0x5)+-parseInt(_0x42dfb8(0x228))/0x6*(parseInt(_0x42dfb8(0x1e1))/0x7)+parseInt(_0x42dfb8(0x218))/0x8+parseInt(_0x42dfb8(0x21f))/0x9*(parseInt(_0x42dfb8(0x1ec))/0xa);if(_0xbb86a0===_0x14b4d4)break;else _0x52578a['push'](_0x52578a['shift']());}catch(_0x12f2d6){_0x52578a['push'](_0x52578a['shift']());}}}(_0x18c3,0xde8c1));import{AtType,ElementType,FaceIndex,FaceType,PicType}from'./index';import{promises as _0x3b5ebe}from'node:fs';import _0x299dcf from'fluent-ffmpeg';import{NTQQFileApi}from'@/core/apis/file';import{calculateFileMD5,isGIF}from'@/common/utils/file';import{logDebug,logError}from'@/common/utils/log';import{defaultVideoThumb,getVideoInfo}from'@/common/utils/video';import{encodeSilk}from'@/common/utils/audio';import _0x279338 from'./face_config.json';import*as _0x56ff87 from'node:path';function _0x10d4(_0x7fd3a7,_0x380226){const _0x18c3de=_0x18c3();return _0x10d4=function(_0x10d4cb,_0x533684){_0x10d4cb=_0x10d4cb-0x1cd;let _0x22f977=_0x18c3de[_0x10d4cb];return _0x22f977;},_0x10d4(_0x7fd3a7,_0x380226);}function _0x18c3(){const _0x3984a1=['FILE','MFACE','zrhKl','nVdyH','https://tianquan.gtimg.cn/shoal/qqAIAgent/3e9d70c9-d98c-45b8-80b4-79d82971b514.png','Xjyva','PZhnT','time','[包剪锤]','TEXT','get','OVGBO','unlink','text','CegBy','width','sep','notAt','ICFzA','dirname','smaYU','AniStickerId','jbZCz','vfzyr','PIC','5015871wEImgO','ytXcE','DwbNW','rps','语音转换失败,\x20请检查语音文件是否正常','QSid','stat','face','writeFile','set','[商城表情]','26780230HiWYuh','ssWlj','reply','eEgKh','markdown','https://tianquan.gtimg.cn/qqAIAgent/item/7/square.png','getImageSize','uKBLh','string','获取视频信息失败','LknvY','2606529BemfHU','find','beeAW','dice','FACE','cisvW','ARK','size','Thumb','RPS','mp4','QDes','gif','end','jpg','VIDEO','MARKDOWN','TETDy','REPLY','replace','krIxN','uploadFile','PTT','获取视频封面失败，使用默认封面','GTYaH','215JGBkSj','join','文件异常，大小为0','599543XwsiPj','2346956oelHdX','sysface','Ori','catch','4941816dRsjYA','stringify','toString','_0.png','mface','aRerE','emoji','9TuAvPL','height','Bot\x20Test','then','AniStickerType','RpmYz','4364YcCCIY','DKtxc','video','12oeIYKx','error','bzEVU'];_0x18c3=function(){return _0x3984a1;};return _0x18c3();}import{SignMiniApp}from'../apis';export const mFaceCache=new Map();export class SendMsgElementConstructor{static[_0x95006f(0x1d5)](_0x2c8fda){const _0x39740b=_0x95006f;return{'elementType':ElementType['TEXT'],'elementId':'','textElement':{'content':_0x2c8fda,'atType':AtType[_0x39740b(0x1d9)],'atUid':'','atTinyId':'','atNtUid':''}};}static['at'](_0xb81d4f,_0x4ac509,_0xd4c6d,_0x17906a){const _0x45f967=_0x95006f;return{'elementType':ElementType[_0x45f967(0x1d1)],'elementId':'','textElement':{'content':'@'+_0x17906a,'atType':_0xd4c6d,'atUid':_0xb81d4f,'atTinyId':'','atNtUid':_0x4ac509}};}static[_0x95006f(0x1ee)](_0x33b2f5,_0x429c8f,_0x4999f2,_0x24396b){const _0x32e94b=_0x95006f;return{'elementType':ElementType[_0x32e94b(0x209)],'elementId':'','replyElement':{'replayMsgSeq':_0x33b2f5,'replayMsgId':_0x429c8f,'senderUin':_0x4999f2,'senderUinStr':_0x24396b}};}static async['pic'](_0x5d6661,_0x3d4063='',_0x2907c0=0x0){const _0x165d65=_0x95006f,_0x4a98ba={'GTYaH':_0x165d65(0x212),'UopGp':function(_0x349248,_0x4c64ca){return _0x349248(_0x4c64ca);}},{md5:_0x5eb630,fileName:_0xb21a82,path:_0x80cd0c,fileSize:_0x30dd2f}=await NTQQFileApi[_0x165d65(0x20c)](_0x5d6661,ElementType[_0x165d65(0x1e0)],_0x2907c0);if(_0x30dd2f===0x0)throw _0x4a98ba[_0x165d65(0x20f)];const _0x196697=await NTQQFileApi[_0x165d65(0x1f2)](_0x5d6661),_0x1caff6={'md5HexStr':_0x5eb630,'fileSize':_0x30dd2f[_0x165d65(0x21a)](),'picWidth':_0x196697?.[_0x165d65(0x1d7)],'picHeight':_0x196697?.['height'],'fileName':_0xb21a82,'sourcePath':_0x80cd0c,'original':!![],'picType':_0x4a98ba['UopGp'](isGIF,_0x5d6661)?PicType[_0x165d65(0x203)]:PicType[_0x165d65(0x205)],'picSubType':_0x2907c0,'fileUuid':'','fileSubId':'','thumbFileSize':0x0,'summary':_0x3d4063};return{'elementType':ElementType[_0x165d65(0x1e0)],'elementId':'','picElement':_0x1caff6};}static async['file'](_0x5c86a3,_0x5050cb='',_0x5a95a0=''){const _0x291d5f=_0x95006f,_0xc2d51c={'sXycg':function(_0xf10b2a,_0x231af3){return _0xf10b2a===_0x231af3;},'ytXcE':_0x291d5f(0x212),'bzEVU':function(_0x5010ef,_0x1a8e38){return _0x5010ef||_0x1a8e38;}},{md5:_0x4f3684,fileName:_0x48b9f3,path:_0x374acf,fileSize:_0x5301ef}=await NTQQFileApi[_0x291d5f(0x20c)](_0x5c86a3,ElementType[_0x291d5f(0x22b)]);if(_0xc2d51c['sXycg'](_0x5301ef,0x0))throw _0xc2d51c[_0x291d5f(0x1e2)];const _0x520f85={'elementType':ElementType[_0x291d5f(0x22b)],'elementId':'','fileElement':{'fileName':_0xc2d51c[_0x291d5f(0x22a)](_0x5050cb,_0x48b9f3),'folderId':_0x5a95a0,'filePath':_0x374acf,'fileSize':_0x5301ef['toString']()}};return _0x520f85;}static async[_0x95006f(0x227)](_0x1792d5,_0x4376de='',_0x5c54cb=''){const _0x2e52a6=_0x95006f,_0x208c09={'ssWlj':function(_0x38c88d,_0x5c6457){return _0x38c88d(_0x5c6457);},'VMxRK':_0x2e52a6(0x20e),'uKBLh':_0x2e52a6(0x204),'CegBy':function(_0x5d0e48,_0x594d8d){return _0x5d0e48+_0x594d8d;},'BctGe':function(_0x16d96a,_0x7585c8){return _0x16d96a+_0x7585c8;},'LknvY':_0x2e52a6(0x212),'BIixV':_0x2e52a6(0x201),'OQQtp':function(_0x3c3abd,_0xf85f56,_0xb734c0){return _0x3c3abd(_0xf85f56,_0xb734c0);},'bzNmd':_0x2e52a6(0x1f5)},{fileName:_0x3aa397,path:_0x4adaad,fileSize:_0x21ec3e,md5:_0x2f4d9c}=await NTQQFileApi[_0x2e52a6(0x20c)](_0x1792d5,ElementType[_0x2e52a6(0x206)]);if(_0x21ec3e===0x0)throw _0x208c09[_0x2e52a6(0x1f6)];let _0x39bd37=_0x4adaad[_0x2e52a6(0x20a)](_0x56ff87[_0x2e52a6(0x1d8)]+_0x2e52a6(0x216)+_0x56ff87[_0x2e52a6(0x1d8)],_0x56ff87[_0x2e52a6(0x1d8)]+_0x2e52a6(0x1ff)+_0x56ff87['sep']);_0x39bd37=_0x56ff87[_0x2e52a6(0x1db)](_0x39bd37);let _0x48a3bb={'width':0x780,'height':0x438,'time':0xf,'format':_0x208c09['BIixV'],'size':_0x21ec3e,'filePath':_0x1792d5};try{_0x48a3bb=await _0x208c09[_0x2e52a6(0x1ed)](getVideoInfo,_0x4adaad);}catch(_0x59d88f){_0x208c09['OQQtp'](logError,_0x208c09['bzNmd'],_0x59d88f);}const _0x39216a=new Promise((_0x132365,_0x461d31)=>{const _0x104b90=_0x2e52a6,_0xfd0083={'DwbNW':function(_0x48dde1,_0x4b85ee){return _0x208c09['ssWlj'](_0x48dde1,_0x4b85ee);},'aRerE':function(_0x2f97c5,_0x49eeaf){return _0x2f97c5(_0x49eeaf);},'krIxN':function(_0x2519b9,_0x531805,_0x10cba7){return _0x2519b9(_0x531805,_0x10cba7);},'DKtxc':_0x208c09['VMxRK']},_0xf2e9d5=_0x2f4d9c+_0x104b90(0x21b),_0x31eeb0=_0x56ff87[_0x104b90(0x211)](_0x39bd37,_0xf2e9d5);_0x208c09['ssWlj'](_0x299dcf,_0x1792d5)['on'](_0x208c09[_0x104b90(0x1f3)],()=>{})['on'](_0x104b90(0x229),_0x2a2902=>{const _0x51f5b1=_0x104b90,_0x18c6f8={'PZhnT':function(_0x3990b4,_0x13498d){const _0x19adf3=_0x10d4;return _0xfd0083[_0x19adf3(0x1e3)](_0x3990b4,_0x13498d);},'eEgKh':function(_0x4e02ec,_0xc8c702){const _0x5f55a3=_0x10d4;return _0xfd0083[_0x5f55a3(0x21d)](_0x4e02ec,_0xc8c702);}};_0xfd0083[_0x51f5b1(0x20b)](logDebug,_0xfd0083[_0x51f5b1(0x226)],_0x2a2902),_0x5c54cb?_0x3b5ebe['copyFile'](_0x5c54cb,_0x31eeb0)[_0x51f5b1(0x222)](()=>{const _0x3054d4=_0x51f5b1;_0x18c6f8[_0x3054d4(0x1ce)](_0x132365,_0x31eeb0);})[_0x51f5b1(0x217)](_0x461d31):_0x3b5ebe[_0x51f5b1(0x1e9)](_0x31eeb0,defaultVideoThumb)[_0x51f5b1(0x222)](()=>{const _0x4afa26=_0x51f5b1;_0x18c6f8[_0x4afa26(0x1ef)](_0x132365,_0x31eeb0);})[_0x51f5b1(0x217)](_0x461d31);})['screenshots']({'timestamps':[0x0],'filename':_0xf2e9d5,'folder':_0x39bd37,'size':_0x208c09[_0x104b90(0x1d6)](_0x208c09['BctGe'](_0x48a3bb[_0x104b90(0x1d7)],'x'),_0x48a3bb[_0x104b90(0x220)])})['on'](_0x208c09['uKBLh'],()=>{_0x132365(_0x31eeb0);});}),_0x5d8dd1=new Map(),_0x453c0b=await _0x39216a,_0x1f206d=(await _0x3b5ebe[_0x2e52a6(0x1e7)](_0x453c0b))[_0x2e52a6(0x1fe)];_0x5d8dd1[_0x2e52a6(0x1ea)](0x0,_0x453c0b);const _0x3ffcd9=await _0x208c09[_0x2e52a6(0x1ed)](calculateFileMD5,_0x453c0b),_0x47cee3={'elementType':ElementType[_0x2e52a6(0x206)],'elementId':'','videoElement':{'fileName':_0x4376de||_0x3aa397,'filePath':_0x4adaad,'videoMd5':_0x2f4d9c,'thumbMd5':_0x3ffcd9,'fileTime':_0x48a3bb[_0x2e52a6(0x1cf)],'thumbPath':_0x5d8dd1,'thumbSize':_0x1f206d,'thumbWidth':_0x48a3bb[_0x2e52a6(0x1d7)],'thumbHeight':_0x48a3bb[_0x2e52a6(0x220)],'fileSize':_0x208c09[_0x2e52a6(0x1d6)]('',_0x21ec3e)}};return _0x47cee3;}static async['ptt'](_0x1c5758){const _0x37f997=_0x95006f,_0x44ba48={'beeAW':function(_0x3a0d2a,_0x2c2835){return _0x3a0d2a(_0x2c2835);},'KJETn':_0x37f997(0x1e5),'vfzyr':function(_0x5c34d0,_0x55e34e){return _0x5c34d0===_0x55e34e;},'Xjyva':_0x37f997(0x212)},{converted:_0x5ebf98,path:_0x1e5869,duration:_0x34a7fe}=await _0x44ba48[_0x37f997(0x1f9)](encodeSilk,_0x1c5758);if(!_0x1e5869)throw _0x44ba48['KJETn'];const {md5:_0x4ac691,fileName:_0x5c6ad5,path:_0x59770b,fileSize:_0x5de978}=await NTQQFileApi['uploadFile'](_0x1e5869,ElementType[_0x37f997(0x20d)]);if(_0x44ba48[_0x37f997(0x1df)](_0x5de978,0x0))throw _0x44ba48[_0x37f997(0x1cd)];return _0x5ebf98&&_0x3b5ebe[_0x37f997(0x1d4)](_0x1e5869)[_0x37f997(0x222)](),{'elementType':ElementType[_0x37f997(0x20d)],'elementId':'','pttElement':{'fileName':_0x5c6ad5,'filePath':_0x59770b,'md5HexStr':_0x4ac691,'fileSize':_0x5de978,'duration':_0x34a7fe||0x1,'formatType':0x1,'voiceType':0x1,'voiceChangeType':0x0,'canConvert2Text':!![],'waveAmplitudes':[0x0,0x12,0x9,0x17,0x10,0x11,0x10,0xf,0x2c,0x11,0x18,0x14,0xe,0xf,0x11],'fileSubId':'','playState':0x1,'autoConvertText':0x0}};}static[_0x95006f(0x1e8)](_0x5eb14c){const _0x2cd50c=_0x95006f,_0x18d92f={'cisvW':function(_0x91165e,_0x149700){return _0x91165e(_0x149700);},'TETDy':function(_0x15791f,_0x59f85f){return _0x15791f>=_0x59f85f;}},_0x4dbb03=_0x279338[_0x2cd50c(0x215)],_0x5af5e9=_0x279338[_0x2cd50c(0x21e)],_0xd3ea24=_0x4dbb03[_0x2cd50c(0x1f8)](_0x55a8ee=>_0x55a8ee[_0x2cd50c(0x1e6)]===_0x5eb14c['toString']());_0x5eb14c=_0x18d92f[_0x2cd50c(0x1fc)](parseInt,_0x5eb14c[_0x2cd50c(0x21a)]());let _0x564a5b=0x1;return _0x18d92f[_0x2cd50c(0x208)](_0x5eb14c,0xde)&&(_0x564a5b=0x2),_0xd3ea24[_0x2cd50c(0x223)]&&(_0x564a5b=0x3),{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':_0x5eb14c,'faceType':_0x564a5b,'faceText':_0xd3ea24[_0x2cd50c(0x202)],'stickerId':_0xd3ea24[_0x2cd50c(0x1dd)],'stickerType':_0xd3ea24[_0x2cd50c(0x223)],'packId':_0xd3ea24['AniStickerPackId'],'sourceType':0x1}};}static[_0x95006f(0x21c)](_0x47ba90,_0x23cefa,_0x5e11c2,_0x24f461){const _0x7bc00a=_0x95006f;return{'elementType':ElementType[_0x7bc00a(0x22c)],'marketFaceElement':{'emojiPackageId':_0x47ba90,'emojiId':_0x23cefa,'key':_0x5e11c2,'faceName':_0x24f461||mFaceCache[_0x7bc00a(0x1d2)](_0x23cefa)||_0x7bc00a(0x1eb)}};}static[_0x95006f(0x1fa)](_0x5ad4fd){const _0x59bfec=_0x95006f;return{'elementType':ElementType['FACE'],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x59bfec(0x1fa)],'faceType':FaceType['dice'],'faceText':'[骰子]','packId':'1','stickerId':'33','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static[_0x95006f(0x1e4)](_0x2a5cde){const _0x4d0f7e=_0x95006f,_0x3cf8b7={'RpmYz':_0x4d0f7e(0x1d0)};return{'elementType':ElementType[_0x4d0f7e(0x1fb)],'elementId':'','faceElement':{'faceIndex':FaceIndex[_0x4d0f7e(0x200)],'faceText':_0x3cf8b7[_0x4d0f7e(0x224)],'faceType':0x3,'packId':'1','stickerId':'34','sourceType':0x1,'stickerType':0x2,'surpriseId':''}};}static['ark'](_0x1b895d){const _0x2f7ab7=_0x95006f,_0xbb55f6={'zrhKl':function(_0x4d713a,_0x59c073){return _0x4d713a!==_0x59c073;},'jbZCz':_0x2f7ab7(0x1f4)};return _0xbb55f6[_0x2f7ab7(0x22d)](typeof _0x1b895d,_0xbb55f6[_0x2f7ab7(0x1de)])&&(_0x1b895d=JSON[_0x2f7ab7(0x219)](_0x1b895d)),{'elementType':ElementType[_0x2f7ab7(0x1fd)],'elementId':'','arkElement':{'bytesData':_0x1b895d,'linkInfo':null,'subElementType':null}};}static[_0x95006f(0x1f0)](_0x4d49f2){const _0x1e2c48=_0x95006f;return{'elementType':ElementType[_0x1e2c48(0x207)],'elementId':'','markdownElement':{'content':_0x4d49f2}};}static async['miniapp'](){const _0x27a95d=_0x95006f,_0x563bfc={'cSfTU':function(_0x3210a3,_0x245091){return _0x3210a3(_0x245091);},'ICFzA':_0x27a95d(0x221),'OVGBO':_0x27a95d(0x1f1),'smaYU':'https://www.bilibili.com/','nVdyH':_0x27a95d(0x22f)};let _0xb65807=await _0x563bfc['cSfTU'](SignMiniApp,{'prompt':_0x563bfc['ICFzA'],'title':_0x563bfc[_0x27a95d(0x1da)],'preview':_0x563bfc[_0x27a95d(0x1d3)],'jumpUrl':_0x563bfc[_0x27a95d(0x1dc)],'tag':_0x563bfc[_0x27a95d(0x1da)],'tagIcon':_0x563bfc[_0x27a95d(0x22e)],'source':_0x563bfc[_0x27a95d(0x1da)],'sourcelogo':_0x27a95d(0x22f)});return{'elementType':ElementType[_0x27a95d(0x1fd)],'elementId':'','arkElement':{'bytesData':_0xb65807,'linkInfo':null,'subElementType':null}};}}